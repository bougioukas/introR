<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.322">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>An Introduction to R - 10&nbsp; Data Visualization: ggplot2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./interactive.html" rel="next">
<link href="./transformation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./introduction.html">Basics</a></li><li class="breadcrumb-item"><a href="./visualization.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Visualization: ggplot2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">An Introduction to R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/bougioukas/introR" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R and Rstudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calculations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Calculations in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R objects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vector.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data structures in R: 1-Dimensional Vectors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data structures in R: matrices and arrays</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data structures in R: lists and data frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data transformation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Visualization: ggplot2</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Special Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Animated and Interactive Plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">SQL queries within R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introduction-to-ggplot2" id="toc-introduction-to-ggplot2" class="nav-link active" data-scroll-target="#introduction-to-ggplot2"><span class="header-section-number">10.1</span> Introduction to ggplot2</a></li>
  <li>
<a href="#dataset-covid-19" id="toc-dataset-covid-19" class="nav-link" data-scroll-target="#dataset-covid-19"><span class="header-section-number">10.2</span> Dataset Covid-19</a>
  <ul class="collapse">
<li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">Load the data</a></li>
  <li><a href="#data-preparation-for-the-plots" id="toc-data-preparation-for-the-plots" class="nav-link" data-scroll-target="#data-preparation-for-the-plots">Data preparation for the plots</a></li>
  </ul>
</li>
  <li>
<a href="#step-by-step-anatomy-of-a-ggplot" id="toc-step-by-step-anatomy-of-a-ggplot" class="nav-link" data-scroll-target="#step-by-step-anatomy-of-a-ggplot"><span class="header-section-number">10.3</span> Step-by-step anatomy of a ggplot</a>
  <ul class="collapse">
<li><a href="#start-with-a-default-blank-ggplot" id="toc-start-with-a-default-blank-ggplot" class="nav-link" data-scroll-target="#start-with-a-default-blank-ggplot">Start with a default blank ggplot</a></li>
  <li><a href="#add-a-geometry" id="toc-add-a-geometry" class="nav-link" data-scroll-target="#add-a-geometry">Add a geometry</a></li>
  <li><a href="#add-aesthtics-to-geometries-aes" id="toc-add-aesthtics-to-geometries-aes" class="nav-link" data-scroll-target="#add-aesthtics-to-geometries-aes">Add aesthtics to geometries: <code>aes()</code></a></li>
  <li><a href="#add-a-new-geom" id="toc-add-a-new-geom" class="nav-link" data-scroll-target="#add-a-new-geom">Add a new geom</a></li>
  </ul>
</li>
  <li>
<a href="#change-the-default-properties-of-the-plot-scales" id="toc-change-the-default-properties-of-the-plot-scales" class="nav-link" data-scroll-target="#change-the-default-properties-of-the-plot-scales"><span class="header-section-number">10.4</span> Change the default properties of the plot: <code>scales</code></a>
  <ul class="collapse">
<li><a href="#change-the-scale-of-the-axis" id="toc-change-the-scale-of-the-axis" class="nav-link" data-scroll-target="#change-the-scale-of-the-axis">Change the scale of the axis</a></li>
  <li><a href="#change-the-default-colors" id="toc-change-the-default-colors" class="nav-link" data-scroll-target="#change-the-default-colors">Change the default colors</a></li>
  <li><a href="#change-the-default-shape-points" id="toc-change-the-default-shape-points" class="nav-link" data-scroll-target="#change-the-default-shape-points">Change the default shape points</a></li>
  </ul>
</li>
  <li><a href="#modify-axis-legend-and-plot-labels-labs" id="toc-modify-axis-legend-and-plot-labels-labs" class="nav-link" data-scroll-target="#modify-axis-legend-and-plot-labels-labs"><span class="header-section-number">10.5</span> Modify axis, legend, and plot labels: <code>labs()</code></a></li>
  <li>
<a href="#modify-theme-components-theme" id="toc-modify-theme-components-theme" class="nav-link" data-scroll-target="#modify-theme-components-theme"><span class="header-section-number">10.6</span> Modify theme components: <code>theme()</code></a>
  <ul class="collapse">
<li><a href="#element_text" id="toc-element_text" class="nav-link" data-scroll-target="#element_text"><code>element_text()</code></a></li>
  <li><a href="#element_line" id="toc-element_line" class="nav-link" data-scroll-target="#element_line"><code>element_line()</code></a></li>
  <li><a href="#element_rect" id="toc-element_rect" class="nav-link" data-scroll-target="#element_rect"><code>element_rect()</code></a></li>
  <li><a href="#element_blank" id="toc-element_blank" class="nav-link" data-scroll-target="#element_blank"><code>element_blank()</code></a></li>
  </ul>
</li>
  <li><a href="#modify-theme-elements-in-practice" id="toc-modify-theme-elements-in-practice" class="nav-link" data-scroll-target="#modify-theme-elements-in-practice"><span class="header-section-number">10.7</span> Modify theme elements in practice</a></li>
  <li><a href="#adding-an-in-build-theme-from-ggplot2" id="toc-adding-an-in-build-theme-from-ggplot2" class="nav-link" data-scroll-target="#adding-an-in-build-theme-from-ggplot2"><span class="header-section-number">10.8</span> Adding an in-build theme from <code>ggplot2</code></a></li>
  <li><a href="#blur-points" id="toc-blur-points" class="nav-link" data-scroll-target="#blur-points"><span class="header-section-number">10.9</span> Blur points</a></li>
  <li><a href="#highlight-data-points" id="toc-highlight-data-points" class="nav-link" data-scroll-target="#highlight-data-points"><span class="header-section-number">10.10</span> Highlight data points</a></li>
  <li><a href="#limit-axis-range-zoom" id="toc-limit-axis-range-zoom" class="nav-link" data-scroll-target="#limit-axis-range-zoom"><span class="header-section-number">10.11</span> Limit Axis Range (Zoom)</a></li>
  <li><a href="#highlight-a-certain-area-of-the-figure" id="toc-highlight-a-certain-area-of-the-figure" class="nav-link" data-scroll-target="#highlight-a-certain-area-of-the-figure"><span class="header-section-number">10.12</span> Highlight a certain area of the figure</a></li>
  <li>
<a href="#split-a-plot-into-a-matrix-of-panels-facet" id="toc-split-a-plot-into-a-matrix-of-panels-facet" class="nav-link" data-scroll-target="#split-a-plot-into-a-matrix-of-panels-facet"><span class="header-section-number">10.13</span> Split a plot into a matrix of panels: <code>facet()</code></a>
  <ul class="collapse">
<li><a href="#facet_wrap-multiple-panel-plots-based-on-one-variable" id="toc-facet_wrap-multiple-panel-plots-based-on-one-variable" class="nav-link" data-scroll-target="#facet_wrap-multiple-panel-plots-based-on-one-variable"><code>facet_wrap</code> multiple-panel plots based on one variable</a></li>
  <li><a href="#facet_grid-multiple-panel-plots-based-on-two-variables" id="toc-facet_grid-multiple-panel-plots-based-on-two-variables" class="nav-link" data-scroll-target="#facet_grid-multiple-panel-plots-based-on-two-variables"><code>facet_grid</code> multiple-panel plots based on two variables</a></li>
  </ul>
</li>
  <li><a href="#practical-example-the-graph-everyone-wants-to-draw" id="toc-practical-example-the-graph-everyone-wants-to-draw" class="nav-link" data-scroll-target="#practical-example-the-graph-everyone-wants-to-draw"><span class="header-section-number">10.14</span> Practical example: the graph everyone wants to draw</a></li>
  <li><a href="#cumulative-number-of-deaths-from-covid-19" id="toc-cumulative-number-of-deaths-from-covid-19" class="nav-link" data-scroll-target="#cumulative-number-of-deaths-from-covid-19"><span class="header-section-number">10.15</span> Cumulative Number of Deaths from COVID-19</a></li>
  <li><a href="#cumulative-number-of-deaths-from-covid-19-in-logarithmic-scale" id="toc-cumulative-number-of-deaths-from-covid-19-in-logarithmic-scale" class="nav-link" data-scroll-target="#cumulative-number-of-deaths-from-covid-19-in-logarithmic-scale"><span class="header-section-number">10.16</span> Cumulative Number of Deaths from COVID-19 in logarithmic scale</a></li>
  <li>
<a href="#combine-several-plots-into-one-figure" id="toc-combine-several-plots-into-one-figure" class="nav-link" data-scroll-target="#combine-several-plots-into-one-figure"><span class="header-section-number">10.17</span> Combine several plots into one figure</a>
  <ul class="collapse">
<li><a href="#assemble-a-number-of-plots" id="toc-assemble-a-number-of-plots" class="nav-link" data-scroll-target="#assemble-a-number-of-plots">Assemble a number of plots</a></li>
  <li><a href="#insets" id="toc-insets" class="nav-link" data-scroll-target="#insets">Insets</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./introduction.html">Basics</a></li><li class="breadcrumb-item"><a href="./visualization.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Visualization: ggplot2</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-visualization" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Visualization: ggplot2</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>When we have finished this chapter, we should be able to:</p>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>use <code>ggplot2</code> to generate publication-ready graphics.</li>
<li>understand the basic grammar of graphics, including the aesthetics and geometry layers, adding statistics, transforming scales, and coloring or panelling by groups.</li>
<li>understand how to save plots in a variety of formats.</li>
<li>find extensions for <code>ggplot2</code> to produce custom graphics.</li>
</ul>
</div>
</div>
<p>&nbsp;</p>
<section id="introduction-to-ggplot2" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="introduction-to-ggplot2">
<span class="header-section-number">10.1</span> Introduction to ggplot2</h2>
<p>The <a href="https://ggplot2.tidyverse.org">ggplot2</a> package is generally the preferred tool of choice for constructing data visualizations in R. The main reason for this is because of its grounding in the grammar of graphics, the idea that any plot can be expressed from the same set of components: a <strong>data</strong> set, a <strong>coordinate system</strong>, and a set of <strong>geoms</strong>–the visual representation of data points. To display values, ggplot2 maps variables in the data to visual properties of the geom (aesthetics) like size, color, and x and y locations. Additionally, the key to understanding ggplot2 is thinking about a figure in <strong>layers</strong>.</p>
<p>There are many extension packages for <code>ggplot2</code>, which make it easy to produce specialized types of graphs, such as survival plots, geographic maps and ROC curves. With <code>ggplot2</code> (and its extensions), users can produce elegant, professional-looking visualizations that communicate results powerfully to the desired audience. However, <code>ggplot2</code> runs into some limitations regarding user interactivity. This becomes increasingly problematic when creating interactive documents using R Markdown or dashboard apps in R Shiny, where interactivity is a crucial component of communicating information effectively.</p>
<p>Fortunately, the <a href="https://plotly-r.com">plotly</a> package significantly enhances the design of interactive charts in R, allowing users to hover over data points, zoom into specific areas, pan back and forth through time, and much more.</p>
</section><section id="dataset-covid-19" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="dataset-covid-19">
<span class="header-section-number">10.2</span> Dataset Covid-19</h2>
<p>In this example, we investigate graphically the association between a country’s wealth and COVID-19 cases. This research question may provide valuable information on whether interventions have been successful, and whether people in countries with fragile health systems are at increased risk.</p>
<p>What other variables are associated to both wealth and COVID-19 cases? For example, wealthier countries may have more resources to test for the virus and a lack of reported cases in developing countries could indicate a scarcity of testing. Therefore, when assessing wealth and COVID-19 cases, we should be cautious when comparing countries with different testing rates. In addition, evidence suggests age is an important factor in COVID-19 infection and mortality. Therefore, we should be careful when comparing countries with higher proportions of older inhabitants to other countries. Using diagrams to depict multivariable associations may be helpful.</p>
<section id="load-the-data" class="level3"><h3 class="anchored" data-anchor-id="load-the-data">Load the data</h3>
<p>We load the file <code>covid_data.csv</code> in R.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="va">covid_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/covid_data.csv"</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"%m/%d/%Y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 132,236 × 14
   iso3c country date       confirmed deaths recovered total_tests region income
   &lt;chr&gt; &lt;chr&gt;   &lt;date&gt;         &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
 1 ABW   Aruba   2020-03-13        NA     NA        NA          NA Latin… High …
 2 ABW   Aruba   2020-03-14        NA     NA        NA          NA Latin… High …
 3 ABW   Aruba   2020-03-15        NA     NA        NA          NA Latin… High …
 4 ABW   Aruba   2020-03-16        NA     NA        NA          NA Latin… High …
 5 ABW   Aruba   2020-03-17        NA     NA        NA          NA Latin… High …
 6 ABW   Aruba   2020-03-18        NA     NA        NA          NA Latin… High …
 7 ABW   Aruba   2020-03-19        NA     NA        NA          NA Latin… High …
 8 ABW   Aruba   2020-03-20        NA     NA        NA          NA Latin… High …
 9 ABW   Aruba   2020-03-21        NA     NA        NA          NA Latin… High …
10 ABW   Aruba   2020-03-22        NA     NA        NA          NA Latin… High …
# ℹ 132,226 more rows
# ℹ 5 more variables: population &lt;dbl&gt;, pop_density &lt;dbl&gt;,
#   life_expectancy &lt;dbl&gt;, gdp_capita &lt;dbl&gt;, timestamp &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Let’s have a look at the types of variables:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">glimpse</span><span class="op">(</span><span class="va">covid_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 132,236
Columns: 14
$ iso3c           &lt;chr&gt; "ABW", "ABW", "ABW", "ABW", "ABW", "ABW", "ABW", "ABW"…
$ country         &lt;chr&gt; "Aruba", "Aruba", "Aruba", "Aruba", "Aruba", "Aruba", …
$ date            &lt;date&gt; 2020-03-13, 2020-03-14, 2020-03-15, 2020-03-16, 2020-…
$ confirmed       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ deaths          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ recovered       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ total_tests     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ region          &lt;chr&gt; "Latin America &amp; Caribbean", "Latin America &amp; Caribbea…
$ income          &lt;chr&gt; "High income", "High income", "High income", "High inc…
$ population      &lt;dbl&gt; 106766, 106766, 106766, 106766, 106766, 106766, 106766…
$ pop_density     &lt;dbl&gt; 593.1444, 593.1444, 593.1444, 593.1444, 593.1444, 593.…
$ life_expectancy &lt;dbl&gt; 76.293, 76.293, 76.293, 76.293, 76.293, 76.293, 76.293…
$ gdp_capita      &lt;dbl&gt; 26631.47, 26631.47, 26631.47, 26631.47, 26631.47, 2663…
$ timestamp       &lt;dttm&gt; 2021-10-09 02:10:32, 2021-10-09 02:10:32, 2021-10-09 …</code></pre>
</div>
</div>
<p>The data frame contains 132236 rows and 14 variables. There are 8 numeric variables, 4 variables of character type, and 2 variables with dates (one of <code>date</code> type and the other of <code>dttm</code> type):</p>
<ul>
<li>
<strong>iso3c:</strong> ISO3c country code as defined by ISO 3166-1 alpha-3</li>
<li>
<strong>country:</strong> Country name</li>
<li>
<strong>date:</strong> Calendar date</li>
<li>
<strong>confirmed:</strong> Confirmed Covid-19 cases as reported by JHU CSSE (accumulated)</li>
<li>
<strong>deaths:</strong> Covid-19-related deaths as reported by JHU CSSE (accumulated)</li>
<li>
<strong>recovered:</strong> Covid-19 recoveries as reported by JHU CSSE (accumulated)</li>
<li>
<strong>total_tests:</strong> Accumulated test counts as reported by Our World in Data</li>
<li>
<strong>region:</strong> Country region as classified by the World Bank (time-stable)</li>
<li>
<strong>income:</strong> Country income group as classified by the World Bank (time-stable)</li>
<li>
<strong>population:</strong> Country population as reported by the World Bank (original identifier ‘SP.POP.TOTL’, time-stable)</li>
<li>
<strong>pop_density:</strong> Country population density as reported by the World Bank (original identifier ‘EN.POP.DNST’, time-stable)</li>
<li>
<strong>life_expectancy</strong> Average life expectancy at birth of country citizens in years as reported by the World Bank (original identifier ‘SP.DYN.LE00.IN’, time-stable)</li>
<li>
<strong>gdp_capita:</strong> Country gross domestic product per capita, measured in 2010 US-$ as reported by the World Bank (original identifier ‘NY.GDP.PCAP.KD’, time-stable)</li>
<li>
<strong>timestamp:</strong> Date and time where data has been collected from authoritative sources</li>
</ul>
<p>Another informative function to inspect our dataset is <code>skim()</code> in the <code>skimr</code> package:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">skimr</span><span class="fu">::</span><span class="fu">skim</span><span class="op">(</span><span class="va">covid_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="data-preparation-for-the-plots" class="level3"><h3 class="anchored" data-anchor-id="data-preparation-for-the-plots">Data preparation for the plots</h3>
<p>The data cover a period from 2019-12-31 to 2021-10-07.</p>
<p>Suppose we are interested in investigating countries with population more than 1 million up to June, 12 2021 and we want also to calculate the cases per 100000 inhabitants and tests per capita:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">covid_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="st">"2021-06-12"</span>, <span class="va">population</span> <span class="op">&gt;</span> <span class="fl">1000000</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cases_per_100k <span class="op">=</span> <span class="va">confirmed</span> <span class="op">/</span> <span class="va">population</span> <span class="op">*</span> <span class="fl">100000</span>,</span>
<span>         tests_per_capita <span class="op">=</span> <span class="va">total_tests</span> <span class="op">/</span> <span class="va">population</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="step-by-step-anatomy-of-a-ggplot" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="step-by-step-anatomy-of-a-ggplot">
<span class="header-section-number">10.3</span> Step-by-step anatomy of a ggplot</h2>
<p>Because <code>ggplot2</code> is a core tidyverse package, it is installed for us when we installed the <code>tidyverse</code> meta-package.</p>
<blockquote class="blockquote">
<p>ggplot2 is a system for declaratively creating graphics, based on The Grammar of Graphics. We provide the data, tell ggplot2 how to map variables to aesthetics, what graphical primitives to use, and it takes care of the details.</p>
</blockquote>
<p>Consequently, a ggplot is built up from a few basic elements (<a href="#fig-ggsyntax" class="quarto-xref">Figure&nbsp;<span>10.1</span></a>):</p>
<ol type="1">
<li>
<strong>Data</strong>: The raw data that we want to plot.</li>
<li>
<strong>Geometries</strong> <code>geom_</code>: The geometric shapes that will represent the data.</li>
<li>
<strong>Aesthetics</strong> <code>aes()</code>: Aesthetics of the geometric and statistical objects, such as color, size, shape, transparency and position.</li>
<li>
<strong>Scales</strong> <code>scale_</code>: Maps between the data and the aesthetic dimensions, such as data range to plot width or factor values to colors.</li>
<li>
<strong>Statistical transformations</strong> <code>stat_</code>: Statistical summaries of the data, such as quantiles, fitted curves and sums.</li>
<li>
<strong>Coordinate system</strong> <code>coord_</code>: The transformation used for mapping data coordinates into the plane of the data rectangle.</li>
<li>
<strong>Facets</strong> <code>facet_</code>: The arrangement of the data into a grid of plots.</li>
<li>
<strong>Visual themes</strong> <code>theme()</code>: The overall visual defaults of a plot, such as background, grids, axes, default typeface, sizes and colors.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ggsyntax" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/ggsyntax.PNG" class="lightbox" title="ggplot2 basic syntax." data-gallery="quarto-lightbox-gallery-1"><img src="images/ggsyntax.PNG" class="img-fluid figure-img" style="width:75.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.1: ggplot2 basic syntax.</figcaption></figure>
</div>
</div>
</div>
<section id="start-with-a-default-blank-ggplot" class="level3"><h3 class="anchored" data-anchor-id="start-with-a-default-blank-ggplot">Start with a default blank ggplot</h3>
<p>We always start to define a plotting element by calling:</p>
<blockquote class="blockquote">
<p><code>ggplot(data = df, mapping = aes(x = variable1, y = variable2))</code>.</p>
</blockquote>
<p>For example, here, we map the variable <code>gdp_capita</code> to the x position and the variable <code>cases_per_100K</code> to the y position. Later, we will also map variables to all kind of other aesthetics such as color, size, and shape.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-canvas" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="visualization_files/figure-html/fig-canvas-1.png" class="lightbox" title="A default blank ggplot." data-gallery="quarto-lightbox-gallery-2"><img src="visualization_files/figure-html/fig-canvas-1.png" class="img-fluid figure-img" width="672"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.2: A default blank ggplot.</figcaption></figure>
</div>
</div>
</div>
<p>The <code>ggplot()</code> function has <strong>two basic arguments</strong>. The argument <code>data</code> defines which dataset to use for the plot; this allows us to refer to <code>gdp_capita</code> and <code>gdp_capita</code> without repeating from which dataset they come. The argument <code>mapping</code> defines which variables are mapped onto which aesthetics. <code>Aesthetics</code> are the visual properties of the elements that make up the plot. For example, <code>aes(x = gdp_capita, y = cases_per_100k)</code> means that the x and y aesthetics of all elements will be mapped onto the variables <code>gdp_capita</code> and <code>gdp_capita</code>, respectively.</p>
<p>As we can see, only a panel is created when running this. Why? This is because we have only told <code>ggplot</code> what dataset to use and what columns should be used for <code>x</code> and <code>y</code> axis. We haven’t explicitly asked it to draw anything else —we still need to provide a geometry!</p>
<p><code>ggplot2</code> allows us to store the current ggobject in an object of our choice by assigning it to a name, in our case called p.&nbsp;We can add other elements on top of the blank layer using the <code>+</code> operator.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>We don’t usually have to spell out data and mapping.</p>
</div>
</div>
<p>Next, suppose that we want to create a scatter plot. This type of graph can be useful for showing the association between at least two variables, because they allow us to encode data simultaneously on a horizontal x‐axis and vertical y‐axis to see whether and what association exists.</p>
</section><section id="add-a-geometry" class="level3"><h3 class="anchored" data-anchor-id="add-a-geometry">Add a geometry</h3>
<p>Geoms are the geometric shapes that make up ggplot2 visualisations (<a href="#fig-geom2var" class="quarto-xref">Figure&nbsp;<span>10.3</span></a>). Each is called with a function that begins with geom_* and ends with the name of the geom (e.g., point or line). Each geom has a number of aesthetics that define its visual properties.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-geom2var" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/geom2var.PNG" class="lightbox" title="Geometries for two continuous variables." data-gallery="quarto-lightbox-gallery-3"><img src="images/geom2var.PNG" class="img-fluid figure-img" style="width:70.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.3: Geometries for two continuous variables.</figcaption></figure>
</div>
</div>
</div>
<p>Let’s tell <code>ggplot2</code> which style we want to use. For example, we will built a scatter plot by adding points using a geom layer called <strong><code>geom_point</code></strong>. In this case, <code>geom_point()</code> inherits the <code>x</code> and <code>y</code> aesthetics from the <code>ggplot()</code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-points" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="visualization_files/figure-html/fig-points-1.png" class="lightbox" title="Adding a geometry of points on the canvas." data-gallery="quarto-lightbox-gallery-4"><img src="visualization_files/figure-html/fig-points-1.png" class="img-fluid figure-img" width="672"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.4: Adding a geometry of points on the canvas.</figcaption></figure>
</div>
</div>
</div>
</section><section id="add-aesthtics-to-geometries-aes" class="level3"><h3 class="anchored" data-anchor-id="add-aesthtics-to-geometries-aes">Add aesthtics to geometries: <code>aes()</code>
</h3>
<p>Each <code>geom</code> comes with its own properties (called arguments) and the same argument may result in a different change depending on the geom we are using.</p>
<p><code>Aesthetic attributes</code> describe every aspect of a given graphical element and refer to which variable is mapped onto it. We can map our data to anything that our geom supports.</p>
<p>To add additional variables to a plot, we can use aesthetics like color, shape, and size.</p>
<blockquote class="blockquote">
<p>Each argument to <code>aes()</code> maps a <strong>variable</strong> in our data to a specific element in our <code>geom</code>.</p>
</blockquote>
<p><strong>A. <code>color</code> aesthetics</strong></p>
<p>Color is an important dimension in human vision and is consequently equally important in the design of a scientific figure. However, color can be either our greatest ally or our worst enemy if not used properly. If we decide to use color, we should consider which colors to use and where to use them.</p>
<p>Color palettes (or colormaps) are classified into three main categories in <code>ggplot2</code>:</p>
<ol type="1">
<li>
<strong>Sequential:</strong> one variation of a unique color, used for <strong>quantitative</strong> data varying from dark to light (<a href="#fig-sequential" class="quarto-xref">Figure&nbsp;<span>10.5</span></a>). These scales may exist in discrete or continuous forms or both.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-sequential" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/sequential.PNG" class="lightbox" title="Example sequential color scales." data-gallery="quarto-lightbox-gallery-5"><img src="images/sequential.PNG" class="img-fluid figure-img" width="485"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.5: Example sequential color scales.</figcaption></figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>
<strong>Diverging:</strong> variation from one color to another, used to highlight <strong>deviation from a median value</strong> (<a href="#fig-gradient" class="quarto-xref">Figure&nbsp;<span>10.6</span></a>) A diverging color scale creates a gradient between three different colors, allowing us to easily identify low, middle, and high values within our data.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gradient" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/gradient.PNG" class="lightbox" title="Example diverging color scales." data-gallery="quarto-lightbox-gallery-6"><img src="images/gradient.PNG" class="img-fluid figure-img" width="478"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.6: Example diverging color scales.</figcaption></figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>
<strong>Qualitative:</strong> a discrete set of distinct colors with no implied order, used mainly for discrete or <strong>categorical</strong> data (<a href="#fig-qualitative" class="quarto-xref">Figure&nbsp;<span>10.7</span></a>).</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="fig-qualitative" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/qualitative.PNG" class="lightbox" title="Example qualitative color scales." data-gallery="quarto-lightbox-gallery-7"><img src="images/qualitative.PNG" class="img-fluid figure-img" width="482"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.7: Example qualitative color scales.</figcaption></figure>
</div>
</div>
</div>
<p>Now, suppose we want to group the points according to the categorical variable <code>region</code> using different colors, as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="visualization_files/figure-html/p3-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Here, we added inside the <code>aes()</code> of <code>geom_point</code> the color aesthetic. The data of the categorical variable <code>region</code> mapped to color aesthetic of <code>geom_point</code>. Obviously, the qualitative scale was applied automatically by <code>ggplot2</code>. In addition, ggplot automatically created a legend to show the correspondence between the regions and colors.</p>
<p>To find all aesthetics that apply to the <code>geom_point()</code> function, run <code>?geom_point</code>. We can find a useful list of all aesthetic specifications there.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The grouping variable must be categorical—in other words, a factor or character vector. If it is stored as a vector of numeric values, it should be converted to a factor before it is used as a grouping variable.</p>
</div>
</div>
<p>It is very important to understand the difference between including <code>ggplot</code> arguments <strong>inside</strong> or <strong>outside</strong> of the <code>aes()</code> function. For example, let’s see the difference if we add the color outside the <code>aes()</code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="visualization_files/figure-html/p4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>In this case, we set an aesthetic to a <strong>fixed value</strong> (red) in the individual layer <code>geom_point</code> outside of <code>aes()</code>. In fact, we set the red color for the entire graph (constant aesthetics), so it changed the color of the plot globally.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>ggplot2 understands both color and colour as well as the short version col</p>
</div>
</div>
<p>In R, colors can be specified either by name (e.g., <code>"blue"</code>) or as a hexadecimal RGB triplet (such as <code>#0072B2</code>). The hexadecimal system defines each color (red, green, or blue) in terms of two values that range from 0–9, then from A–F, giving a total of 16 different values for each character.</p>
<p>We can also use palettes of colors such as <code>viridis</code> palette which we will use in the next graphs. In following Table we present a color blind-friendly palette.</p>
<p>In R, the hex color code goes in quotes and is preceded by a #. For example:</p>
<table class="table">
<thead><tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Hex code</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">orange</td>
<td style="text-align: left;">#E69F00</td>
</tr>
<tr class="even">
<td style="text-align: left;">sky blue</td>
<td style="text-align: left;">#56B4E9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bluish green</td>
<td style="text-align: left;">#009E73</td>
</tr>
<tr class="even">
<td style="text-align: left;">yellow</td>
<td style="text-align: left;">#F0E442</td>
</tr>
<tr class="odd">
<td style="text-align: left;">blue</td>
<td style="text-align: left;">#0072B2</td>
</tr>
<tr class="even">
<td style="text-align: left;">vermilion</td>
<td style="text-align: left;">#D55E00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">reddish purple</td>
<td style="text-align: left;">#CC79A7</td>
</tr>
<tr class="even">
<td style="text-align: left;">black</td>
<td style="text-align: left;">#000000</td>
</tr>
</tbody>
</table>
<p>Although the code for hexadecimal may not be intuitive, it is easy to look up online exactly what the code is for any color we want to use (just do an internet search for something like “RGB to Hex color”). The main advantage of the Hex system over RGB is that it is very compact to specify whatever color we want.</p>
<p><strong>B. <code>shape</code> aesthetics</strong></p>
<p>Alternatively, we can group the points according to the <code>region</code> variable using different point shapes, as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>shape <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The shape palette can deal with a maximum of 6 discrete values because
more than 6 becomes difficult to discriminate; you have 7. Consider
specifying shapes manually if you must have them.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 46 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="visualization_files/figure-html/p5-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The different points shapes symbols commonly used in R are shown in the <a href="#fig-symbols" class="quarto-xref">Figure&nbsp;<span>10.8</span></a> below:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-symbols" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/symbols.PNG" class="lightbox" title="The different points symbols commonly used in R." data-gallery="quarto-lightbox-gallery-11"><img src="images/symbols.PNG" class="img-fluid figure-img" style="width:60.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.8: The different points symbols commonly used in R.</figcaption></figure>
</div>
</div>
</div>
<p>As we can observe in the previous graph, <code>ggplot2</code> by default allows only six different point shapes to be displayed. However, we will see how to change this using appropriate <code>scales</code>.</p>
<p><strong>C. <code>size</code> aesthetics</strong></p>
<p>Next, we can add a third variable <code>tests_per_capita</code> using the size aesthetic:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="visualization_files/figure-html/p6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="add-a-new-geom" class="level3"><h3 class="anchored" data-anchor-id="add-a-new-geom">Add a new geom</h3>
<p>We can add the name of the country for each data point:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_text_repel()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 93 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="visualization_files/figure-html/p7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section></section><section id="change-the-default-properties-of-the-plot-scales" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="change-the-default-properties-of-the-plot-scales">
<span class="header-section-number">10.4</span> Change the default properties of the plot: <code>scales</code>
</h2>
<section id="change-the-scale-of-the-axis" class="level3"><h3 class="anchored" data-anchor-id="change-the-scale-of-the-axis">Change the scale of the axis</h3>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="co"># or scale_y_log10()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_text_repel()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 117 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="visualization_files/figure-html/p8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Continuous variable <code>tests_per_capital</code> mapped to size and categorical variable <code>region</code> mapped to color.</p>
</section><section id="change-the-default-colors" class="level3"><h3 class="anchored" data-anchor-id="change-the-default-colors">Change the default colors</h3>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_text_repel()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 117 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="visualization_files/figure-html/p9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="change-the-default-shape-points" class="level3"><h3 class="anchored" data-anchor-id="change-the-default-shape-points">Change the default shape points</h3>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, shape<span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_shape_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">16</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">19</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_text_repel()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 117 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p9.1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="visualization_files/figure-html/p9.1-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>However, when a variable is mapped to size (here, <code>test_per_capital</code>), it’s a good idea to not map a variable to shape (here, <code>region</code>). This is because it is difficult to compare the sizes of different shapes (e.g., a size 4 square with a size 4 triangle). Also, some of the shapes really are different sizes: shapes 16 and 19 are both circles, but at any given numeric size, shape 19 circles are visually larger than shape 16 circles.</p>
</section></section><section id="modify-axis-legend-and-plot-labels-labs" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="modify-axis-legend-and-plot-labels-labs">
<span class="header-section-number">10.5</span> Modify axis, legend, and plot labels: <code>labs()</code>
</h2>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"GDP per capita ($)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cases per 100,000 inhabitants"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       size <span class="op">=</span> <span class="st">"Proportion tested"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Confirmed cases per 100,000 inhabitants, GDP per capita, and COVID-19 testing rate by country"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"May 20, 2021"</span>, </span>
<span>       caption <span class="op">=</span> <span class="st">"Source Data: Covid-19 related data from {tidycovid19} package"</span>,</span>
<span>       tag <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_text_repel()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 127 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="visualization_files/figure-html/p11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="modify-theme-components-theme" class="level2" data-number="10.6"><h2 data-number="10.6" class="anchored" data-anchor-id="modify-theme-components-theme">
<span class="header-section-number">10.6</span> Modify theme components: <code>theme()</code>
</h2>
<p>We can fine tune the appearance of the graph using themes. Theme functions (which start with <code>element_</code>) control background colors, fonts, grid-lines, legend placement, and other non-data related features of the graph.</p>
<p>This function is very complex since it allows you to specify all the different details contributing to the plot appearance as well as generating your own format and style.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-theme_elements" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/theme_elements.png" class="lightbox" title="The different points symbols commonly used in R." data-gallery="quarto-lightbox-gallery-18"><img src="images/theme_elements.png" class="img-fluid figure-img" style="width:100.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.9: The different points symbols commonly used in R.</figcaption></figure>
</div>
</div>
</div>
<p><code>ggplot2</code> theme system comes with multiple <code>element_</code> functions:</p>
<ul>
<li>
<code>element_text()</code>: specify the display of text elements</li>
<li>
<code>element_line()</code>: specify the display of lines (i.e.&nbsp;axis lines)</li>
<li>
<code>element_rect()</code>: specify the display of borders and backgrounds</li>
<li>
<code>element_blank()</code>draw nothing</li>
</ul>
<section id="element_text" class="level3"><h3 class="anchored" data-anchor-id="element_text"><code>element_text()</code></h3>
<p>While making a plot with <code>ggplot2</code>, it automatically chooses appropriate values for various aspects of <strong>element text</strong>. In total there are 10 different aspects/elements of texts in a plot made with <code>ggplot2</code>. The figure below shows the anatomy of text elements and the key word in ggplot2 describing the element.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-element_text" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/element_text.PNG" class="lightbox" title="Anatomy of Text Elements in ggplot2." data-gallery="quarto-lightbox-gallery-19"><img src="images/element_text.PNG" class="img-fluid figure-img" style="width:100.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.10: Anatomy of Text Elements in ggplot2.</figcaption></figure>
</div>
</div>
</div>
<p>With <code>element_text()</code>, we can customize the looks of the the texts. For example, to control the look of title of a plot, we will use <code>plot.title</code> element as argument to <code>theme()</code> function and use <code>element_text()</code> to specify the color, font and size of the plot title.</p>
</section><section id="element_line" class="level3"><h3 class="anchored" data-anchor-id="element_line"><code>element_line()</code></h3>
<p>With <code>element_line()</code>, we can customize all the lines that are not part of data. For example, we can customize the color of <code>x</code> and <code>y</code> axis lines, we can make the axis lines as arrows, and we can add second x-axis on top and so on.</p>
<p>Broadly, with <code>element_line()</code> we can customize three groups of lines in a plot. First, are <code>X</code> and <code>Y</code> axis lines. Second, are the lines associated with <strong>tick</strong> on <code>X</code> and <code>Y</code> axis. And the third, are the <strong>major</strong> and <strong>minor</strong> grid lines along both <code>X</code> and <code>Y</code> axis. The figure below shows the anatomy of line elements and the key word in ggplot2 describing the element.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-element_line" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/element_line.PNG" class="lightbox" title="Anatomy of Line Elements in ggplot2." data-gallery="quarto-lightbox-gallery-20"><img src="images/element_line.PNG" class="img-fluid figure-img" style="width:100.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.11: Anatomy of Line Elements in ggplot2.</figcaption></figure>
</div>
</div>
</div>
</section><section id="element_rect" class="level3"><h3 class="anchored" data-anchor-id="element_rect"><code>element_rect()</code></h3>
<p>With <code>element_rect()</code>, we can customize all things that are rectangular in a plot. For example, we can customize the line and fill colors of rectangles that define borders and backgrounds in a plot.</p>
<p>In total there are 7 aspects of rectangular elements we can control using using <code>element_rect()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-element_rect" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/element_rect.PNG" class="lightbox" title="Anatomy of Rectangle Elements in ggplot2." data-gallery="quarto-lightbox-gallery-21"><img src="images/element_rect.PNG" class="img-fluid figure-img" style="width:100.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.12: Anatomy of Rectangle Elements in ggplot2.</figcaption></figure>
</div>
</div>
</div>
</section><section id="element_blank" class="level3"><h3 class="anchored" data-anchor-id="element_blank"><code>element_blank()</code></h3>
<p>If we look at the <code>ggplot2</code> theme documentation page, we can see that <code>element_blank()</code> does not take any arguments. So what does it do? As it says <code>element_blank()</code>: draws nothing, and assigns no space. We can use <code>element_blank()</code> if we don’t want any specific non-data plot elements drawn on the plot (we disable them). With <code>element_blank()</code> we can suppress or remove change for each of the theme elements. For example, using <code>panel.grid.minor = element_blank()</code> in the <code>theme()</code> we disable the minor grid lines of the panel.</p>
</section></section><section id="modify-theme-elements-in-practice" class="level2" data-number="10.7"><h2 data-number="10.7" class="anchored" data-anchor-id="modify-theme-elements-in-practice">
<span class="header-section-number">10.7</span> Modify theme elements in practice</h2>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"GDP per capita ($)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cases per 100,000 inhabitants"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       size <span class="op">=</span> <span class="st">"Proportion tested"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Confirmed cases per 100,000 inhabitants, GDP per capita, and COVID-19 \ntesting rate by country"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"May 20, 2021"</span>, </span>
<span>       caption <span class="op">=</span> <span class="st">"Source Data: Covid-19 related data from {tidycovid19} package"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>        <span class="co"># background, panel and grid lines</span></span>
<span>        plot.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>        panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        <span class="co"># title, subtitle and caption</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        <span class="co"># axis</span></span>
<span>        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        <span class="co"># legend</span></span>
<span>        legend.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        legend.key <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>        legend.position<span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.box <span class="op">=</span> <span class="st">'vertical'</span></span>
<span>        <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_text_repel()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 61 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="visualization_files/figure-html/p12-1.png" class="img-fluid figure-img" width="1536"></a></p>
</figure>
</div>
</div>
</div>
<p>The figure depicts strong, positive relationships between the following pairs of variables: wealth/COVID-19 cases, wealth/COVID-19 testing, and COVID-19 cases/testing. Note the use of two plot attributes (size and color) to depict additional variables.</p>
</section><section id="adding-an-in-build-theme-from-ggplot2" class="level2" data-number="10.8"><h2 data-number="10.8" class="anchored" data-anchor-id="adding-an-in-build-theme-from-ggplot2">
<span class="header-section-number">10.8</span> Adding an in-build theme from <code>ggplot2</code>
</h2>
<p>While it is possible to build up a new theme from the ground it is usually easier and less error-prone to modify an existing theme. This is done in <code>ggplot2</code> as well as can be seen by looking at e.g., <code>theme_minimal()</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"GDP per capita ($)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cases per 100,000 inhabitants"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       size <span class="op">=</span> <span class="st">"Proportion tested"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Confirmed cases per 100,000 inhabitants, GDP per capita, and COVID-19 testing rate by country"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"May 20, 2021"</span>, </span>
<span>       caption <span class="op">=</span> <span class="st">"Source Data: Covid-19 related data from {tidycovid19} package"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 76 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing missing values (`geom_text_repel()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 114 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p12.1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="visualization_files/figure-html/p12.1-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>In-build theme from ggplot2:</p>
<ul>
<li>
<strong>theme_gray()</strong> – signature ggplot2 theme</li>
<li>
<strong>theme_bw()</strong> – dark on light ggplot2 theme</li>
<li>
<strong>theme_linedraw()</strong> – uses black lines on white backgrounds only</li>
<li>
<strong>theme_light()</strong> – similar to linedraw() but with grey lines aswell</li>
<li>
<strong>theme_dark()</strong> – lines on a dark background instead of light</li>
<li>
<strong>theme_minimal()</strong> – no background annotations, minimal feel.</li>
<li>
<strong>theme_classic()</strong> – theme with no grid lines.</li>
<li>
<strong>theme_void()</strong> – empty theme with no elements</li>
</ul></section><section id="blur-points" class="level2" data-number="10.9"><h2 data-number="10.9" class="anchored" data-anchor-id="blur-points">
<span class="header-section-number">10.9</span> Blur points</h2>
<p>We can focus the attention on specific region e.g.&nbsp;<code>East Asia and Pacific</code> countries. One solution is to blur all the points that we do not want to highlight. We will use the <code>with_blur()</code> function, which blurs the layers to which it is applied.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span>, size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">with_blur</span><span class="op">(</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">region</span> <span class="op">!=</span> <span class="st">"East Asia &amp; Pacific"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.95</span>, <span class="st">'mm'</span><span class="op">)</span> <span class="co"># you can choose the amount of blur </span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">region</span> <span class="op">==</span> <span class="st">"East Asia &amp; Pacific"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">region</span> <span class="op">==</span> <span class="st">"East Asia &amp; Pacific"</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>                  color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"GDP per capita ($)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cases per 100,000 inhabitants"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       size <span class="op">=</span> <span class="st">"Proportion tested"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Confirmed cases per 100,000 inhabitants, GDP per capita, and &lt;span style='font-size:18pt'&gt;COVID-19&lt;/span&gt; testing rate by country with emphasis in  &lt;br&gt; &lt;span style='color:#E64B35FF'&gt;East Asia &amp; Pacific&lt;/span&gt; countries"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"May 20, 2021"</span>, </span>
<span>       caption <span class="op">=</span> <span class="st">"Source Data: Covid-19 related data from {tidycovid19} package"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p13.3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="visualization_files/figure-html/p13.3-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>In the above graph, additional styling was applied via inline CSS (Cascading Style Sheets) to the title. The CSS properties color, font-size, and font-family are currently supported.</p>
<blockquote class="blockquote">
<p>The <code>ggtext</code> package defines a new theme element, <code>element_markdown()</code>. It behaves similarly to element_text() but render the provided text as <code>markdown/html</code>. <code>element_markdown()</code> is meant as a direct replacement for <code>element_text()</code>, and it renders text without word wrapping. To start a new line, use the <code>&lt;br&gt;</code> tag or add two spaces before the end of a line.</p>
</blockquote>
</section><section id="highlight-data-points" class="level2" data-number="10.10"><h2 data-number="10.10" class="anchored" data-anchor-id="highlight-data-points">
<span class="header-section-number">10.10</span> Highlight data points</h2>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span>, </span>
<span>                color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">gghighlight</span><span class="op">(</span><span class="va">region</span> <span class="op">==</span> <span class="st">"East Asia &amp; Pacific"</span>, keep_scales <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              use_direct_label <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>,</span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.3</span>, </span>
<span>                  color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"GDP per capita ($)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cases per 100,000 inhabitants"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       size <span class="op">=</span> <span class="st">"Proportion tested"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Confirmed cases per 100,000 inhabitants, GDP per capita, and &lt;span style='font-size:14pt'&gt;COVID-19&lt;/span&gt; testing rate by country with emphasis in  &lt;br&gt; &lt;span style='color:#E64B35FF'&gt;East Asia &amp; Pacific&lt;/span&gt; countries"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"May 20, 2021"</span>, </span>
<span>       caption <span class="op">=</span> <span class="st">"Source Data: Covid-19 related data from {tidycovid19} package"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p13.31-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="visualization_files/figure-html/p13.31-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="limit-axis-range-zoom" class="level2" data-number="10.11"><h2 data-number="10.11" class="anchored" data-anchor-id="limit-axis-range-zoom">
<span class="header-section-number">10.11</span> Limit Axis Range (Zoom)</h2>
<p>Sometimes we want to zoom into our data. We can do this without subsettting our data. We can change the <code>X</code> and <code>Y</code> axis limits by zooming in to the region of interest without deleting points. This is done using <code>coord_cartesian()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"GDP per capita ($)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cases per 100,000 inhabitants"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       size <span class="op">=</span> <span class="st">"Proportion tested"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.8</span><span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="fl">3</span>, <span class="fl">1.6</span><span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.box <span class="op">=</span> <span class="st">'vertical'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p13.4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="visualization_files/figure-html/p13.4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Note that the text is above the points, because it is the ‘top layer’ of the plot. The <code>geom_*</code> layers that appear early in the command are drawn first, and can be obscured by the <code>geom_*</code> layers that come after them.</p>
<p>What happens if we switch the order of the <code>geom_point()</code> and <code>geom_text()</code> functions above? What do we notice?</p>
</section><section id="highlight-a-certain-area-of-the-figure" class="level2" data-number="10.12"><h2 data-number="10.12" class="anchored" data-anchor-id="highlight-a-certain-area-of-the-figure">
<span class="header-section-number">10.12</span> Highlight a certain area of the figure</h2>
<p>The <code>facet_zoom()</code> function from the package <code>ggforce</code> provides the means to zoom in on a subset of the data, while keeping the view of the full dataset as a separate panel.</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"GDP per capita ($)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cases per 100,000 inhabitants"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       size <span class="op">=</span> <span class="st">"Proportion tested"</span></span>
<span>       <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_zoom</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">70000</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p13.5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="visualization_files/figure-html/p13.5-1.png" class="img-fluid figure-img" width="1536"></a></p>
</figure>
</div>
</div>
</div>
<p>Another way to zoom-in detail is using the package <code>ggpp</code>. The <code>geom_plot()</code> geometry plots ggplot objects, nested in a tibble passed as data argument, using aesthetics <code>x</code> and <code>y</code> for positioning, and label for the ggplot object containing the definition of the plot to be nested. As an example we produce a plot where the inset plot is a zoomed-in detail from the main plot. In this case the main and inset plots start as the same plot.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the inset plot</span></span>
<span><span class="va">gp1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">data.tb</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">110000</span>, y <span class="op">=</span> <span class="fl">1</span>, </span>
<span>         plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">gp1</span> <span class="op">+</span> </span>
<span>                       <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30000</span>, <span class="fl">80000</span><span class="op">)</span>, </span>
<span>                                       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4000</span>, <span class="fl">11000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>                       <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the main plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>size <span class="op">=</span> <span class="va">tests_per_capita</span>, color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_plot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data.tb</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="va">plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"rect"</span>, </span>
<span>            xmin <span class="op">=</span> <span class="fl">30000</span>, xmax <span class="op">=</span> <span class="fl">80000</span>, </span>
<span>           ymin <span class="op">=</span> <span class="fl">4000</span>, ymax <span class="op">=</span> <span class="fl">11000</span>,</span>
<span>           linetype <span class="op">=</span> <span class="st">"dotted"</span>, </span>
<span>           fill <span class="op">=</span> <span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_npg</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"GDP per capita ($)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cases per 100,000 inhabitants"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>       size <span class="op">=</span> <span class="st">"Proportion tested"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="visualization_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="split-a-plot-into-a-matrix-of-panels-facet" class="level2" data-number="10.13"><h2 data-number="10.13" class="anchored" data-anchor-id="split-a-plot-into-a-matrix-of-panels-facet">
<span class="header-section-number">10.13</span> Split a plot into a matrix of panels: <code>facet()</code>
</h2>
<p>Another technique for displaying categorical variables on a plot is faceting. The facet approach partitions a plot into a matrix of panels. Each panel shows a different subset of the data. Coordinate systems and faceting control the position of elements of the plot.</p>
<p>There are two types of faceting provided by <code>ggplot2</code>: <code>facet_wrap</code> and <code>facet_grid</code>. <strong>Facet wrap</strong> produces a 1d ribbon of panels that is wrapped into 2d to save space, while <strong>facet grid</strong> produces a <code>2d</code> grid of panels defined by variables which form the rows and columns. These differences are illustrated in Figure <span class="math inline">\(\ref{fig:facets}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-facets" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/facets.PNG" class="lightbox" title="A sketch illustrating the difference between the two faceting systems." data-gallery="quarto-lightbox-gallery-29"><img src="images/facets.PNG" class="img-fluid figure-img" style="width:80.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.13: A sketch illustrating the difference between the two faceting systems.</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-facet_elements" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><a href="images/facet_elements.png" class="lightbox" title="ggplot2 basic theme and facet elements." data-gallery="quarto-lightbox-gallery-30"><img src="images/facet_elements.png" class="img-fluid figure-img" style="width:80.0%"></a></p>
<figcaption class="figure-caption">Figure&nbsp;10.14: ggplot2 basic theme and facet elements.</figcaption></figure>
</div>
</div>
</div>
<section id="facet_wrap-multiple-panel-plots-based-on-one-variable" class="level3"><h3 class="anchored" data-anchor-id="facet_wrap-multiple-panel-plots-based-on-one-variable">
<code>facet_wrap</code> multiple-panel plots based on one variable</h3>
<p>Facets can be placed next to each other, wrapping with a certain number of columns or rows. The label for each plot will be at the top of the plot.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span>,  color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">region</span>,  ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="visualization_files/figure-html/p14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The points in a scatter plot may obscure each other and prevent the viewer from accurately assessing the distribution of the data. This is called overplotting. If the amount of overplotting is low, you may be able to alleviate it by using smaller points, by using a different shape through which other points can be seen, or making the points semitransparent using <code>alpha</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdp_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">region</span>,  ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p14.2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="visualization_files/figure-html/p14.2-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="facet_grid-multiple-panel-plots-based-on-two-variables" class="level3"><h3 class="anchored" data-anchor-id="facet_grid-multiple-panel-plots-based-on-two-variables">
<code>facet_grid</code> multiple-panel plots based on two variables</h3>
<p>The <code>facet_grid()</code> function does a similar thing but instead of creating different plots it creates different grids and then plots each plot in the grids. The data can be split up by one or two variables that vary on the horizontal and/or vertical direction. This is done by giving a formula to <code>facet_grid()</code>, of the form vertical ~ horizontal.</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">income</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low income"</span>, </span>
<span>                                            <span class="st">"Lower middle income"</span>,</span>
<span>                                            <span class="st">"Upper middle income"</span>,</span>
<span>                                            <span class="st">"High income"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="st">"income"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">tests_per_capita</span>, y <span class="op">=</span> <span class="va">cases_per_100k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, </span>
<span>                  min.segment.length <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>                  box.padding <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"gray30"</span>, </span>
<span>                   segment.size <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">region</span><span class="op">~</span><span class="va">income</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/p15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="visualization_files/figure-html/p15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Note that the lines which come before the <code>ggplot()</code> function are piped <code>%&gt;%</code> whereas from <code>ggplot()</code> onwards we have to use <code>+</code>. This is because <code>ggplot2</code> package was written before the pipe <code>%&gt;%</code> was introduced. The <code>+</code> sign in <code>ggplot2</code> functions (similar to the pipe <code>%&gt;%</code> in other functions in the tidyverse) allows code to be written from left to right adding different layers and customisations to the same plot.</p>
<p>Moreover, as commands get longer, we suggest to add carriage returns (new lines), which must be inserted after the <code>%&gt;%</code> or <code>+</code> symbols. In most cases, R is blind to white space and new lines, so this is a simple way to make our code more readable.</p>
</section></section><section id="practical-example-the-graph-everyone-wants-to-draw" class="level2" data-number="10.14"><h2 data-number="10.14" class="anchored" data-anchor-id="practical-example-the-graph-everyone-wants-to-draw">
<span class="header-section-number">10.14</span> Practical example: the graph everyone wants to draw</h2>
</section><section id="cumulative-number-of-deaths-from-covid-19" class="level2" data-number="10.15"><h2 data-number="10.15" class="anchored" data-anchor-id="cumulative-number-of-deaths-from-covid-19">
<span class="header-section-number">10.15</span> Cumulative Number of Deaths from COVID-19</h2>
<p>Seeing the total number of deaths over time, on a country-by-country basis, can illustrate how the pandemic is expanding. Because the epidemic began at different times in different countries, viewing each country’s curve from the same starting point can allow us to more easily compare countries. The starting point for this chart is the day on which the 10th death was confirmed in each country, with the trend lines following the number of days since that event.</p>
<p>Let’s say we want to focus on data of specific countries:</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">focus_cn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CHN"</span>, <span class="st">"GBR"</span>, <span class="st">"USA"</span>, <span class="st">"JPN"</span>, <span class="st">"GRC"</span>, <span class="st">"MEX"</span>,</span>
<span>              <span class="st">"KOR"</span>, <span class="st">"ITA"</span>, <span class="st">"ESP"</span>, <span class="st">"BRA"</span>, <span class="st">"IND"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, we have to prepare the data:</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">covid_deaths</span> <span class="op">&lt;-</span> <span class="va">covid_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">date</span>, <span class="va">iso3c</span>, <span class="va">deaths</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">iso3c</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">deaths</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>days_elapsed <span class="op">=</span> <span class="va">date</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         end_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, <span class="va">iso3c</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>         end_label <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">iso3c</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">focus_cn</span> <span class="op">~</span> <span class="va">end_label</span>,</span>
<span>                      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span>,</span>
<span>         cgroup <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">iso3c</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">focus_cn</span> <span class="op">~</span> <span class="va">iso3c</span>,</span>
<span>                   <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"OTHER"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_deaths</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87,842 × 6
   date       iso3c deaths days_elapsed end_label cgroup
   &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;drtn&gt;       &lt;chr&gt;     &lt;chr&gt; 
 1 2020-01-22 CHN       17 0 days       &lt;NA&gt;      CHN   
 2 2020-01-23 CHN       18 1 days       &lt;NA&gt;      CHN   
 3 2020-01-24 CHN       26 2 days       &lt;NA&gt;      CHN   
 4 2020-01-25 CHN       42 3 days       &lt;NA&gt;      CHN   
 5 2020-01-26 CHN       56 4 days       &lt;NA&gt;      CHN   
 6 2020-01-27 CHN       82 5 days       &lt;NA&gt;      CHN   
 7 2020-01-28 CHN      131 6 days       &lt;NA&gt;      CHN   
 8 2020-01-29 CHN      133 7 days       &lt;NA&gt;      CHN   
 9 2020-01-30 CHN      171 8 days       &lt;NA&gt;      CHN   
10 2020-01-31 CHN      213 9 days       &lt;NA&gt;      CHN   
# ℹ 87,832 more rows</code></pre>
</div>
</div>
<p>We also set particular colors for the selected countries:</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Colors</span></span>
<span><span class="va">cgroup_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">prismatic</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prismatic/man/clr_darken.html">clr_darken</a></span><span class="op">(</span></span>
<span>  <span class="fu">paletteer_d</span><span class="op">(</span><span class="st">"ggsci::category20_d3"</span><span class="op">)</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">focus_cn</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="st">"gray70"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we are ready to create the chart with the cumulative number of confirmed deaths:</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">death_curves</span> <span class="op">&lt;-</span> <span class="va">covid_deaths</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">cgroup</span> <span class="op">!=</span> <span class="st">"OTHER"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">days_elapsed</span>, y <span class="op">=</span> <span class="va">deaths</span>,</span>
<span>                         color <span class="op">=</span> <span class="va">cgroup</span>, label <span class="op">=</span> <span class="va">end_label</span>,</span>
<span>                         group <span class="op">=</span> <span class="va">iso3c</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_text_repel</span><span class="op">(</span>nudge_x <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                    nudge_y <span class="op">=</span> <span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                    segment.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">cgroup_cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">6.1</span><span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6.</span><span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Days Since 10th Confirmed Death"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Cumulative Number of Deaths"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"Cumulative Number of Deaths from COVID-19"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Data as of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">covid_deaths</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>,</span>
<span>                                               <span class="st">"%d/%m/%y"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Data: https://coronavirus.jhu.edu/map.html"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">death_curves</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="visualization_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="cumulative-number-of-deaths-from-covid-19-in-logarithmic-scale" class="level2" data-number="10.16"><h2 data-number="10.16" class="anchored" data-anchor-id="cumulative-number-of-deaths-from-covid-19-in-logarithmic-scale">
<span class="header-section-number">10.16</span> Cumulative Number of Deaths from COVID-19 in logarithmic scale</h2>
<p>Next, we present the chart with the cumulative number of confirmed deaths in logarithmic scale:</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">death_log_curves</span> <span class="op">&lt;-</span> <span class="va">covid_deaths</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">cgroup</span> <span class="op">!=</span> <span class="st">"OTHER"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">days_elapsed</span>, y <span class="op">=</span> <span class="va">deaths</span>,</span>
<span>                         color <span class="op">=</span> <span class="va">cgroup</span>, label <span class="op">=</span> <span class="va">end_label</span>,</span>
<span>                         group <span class="op">=</span> <span class="va">iso3c</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_text_repel</span><span class="op">(</span>nudge_x <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                    nudge_y <span class="op">=</span> <span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                    segment.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">cgroup_cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">2</span><span class="op">^</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>                       breaks <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                       trans <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Days Since 10th Confirmed Death"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Cumulative Number of Deaths (log2 scale)"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"Cumulative Number of Deaths (log scale) from COVID-19"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Data as of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">covid_deaths</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>,</span>
<span>                                               <span class="st">"%d/%m/%y"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Data: https://coronavirus.jhu.edu/map.html"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">death_log_curves</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="visualization_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>This chart shows the cumulative number of confirmed deaths since the 10th confirmed death for each country. An upward bend in a curve can indicate either a time of explosive growth of coronavirus cases in a given country or a change in how deaths are defined or counted. Comparing across countries can also show where the pandemic is growing most rapidly at any point in time.</p>
<p>Limited testing and challenges in the attribution of the cause of death means that the number of confirmed deaths may not be an accurate count of the true number of deaths from COVID-19.</p>
</section><section id="combine-several-plots-into-one-figure" class="level2" data-number="10.17"><h2 data-number="10.17" class="anchored" data-anchor-id="combine-several-plots-into-one-figure">
<span class="header-section-number">10.17</span> Combine several plots into one figure</h2>
<section id="assemble-a-number-of-plots" class="level3"><h3 class="anchored" data-anchor-id="assemble-a-number-of-plots">Assemble a number of plots</h3>
<p>Sometimes, we would like to combine several plots into one figure. This can be easily done with the <code>patchwork</code> package. For example, if we want to combine two <code>ggplot2</code> objects, say <code>death_curves</code> and <code>death_log_curves</code>, then we can directly call <code>death_curves + death_log_curves</code> to combine the two objects. Since the two plots share the same elements, patchwork allows us to use e.g.&nbsp;one top title, subtitle and tags by calling function <code>plot_annotation</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">death_curves</span> <span class="op">+</span> <span class="va">death_log_curves</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_annotation</span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Cumulative Number of Deaths'</span>,</span>
<span>                  subtitle <span class="op">=</span> <span class="st">'A: Linear scale; B: Log scale'</span>,</span>
<span>                  tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="visualization_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="insets" class="level3"><h3 class="anchored" data-anchor-id="insets">Insets</h3>
<p>Another approach is to use the <code>inset_element()</code> function which marks a plot or graphic object to be placed as an inset on the previous plot. It will thus not take up a slot in the provided layout, but share the slot with the previous plot. <code>inset_element()</code> allows us to freely position our inset relative to either the panel, plot, or full area of the previous plot, by specifying the location of the left, bottom, right, and top edge of the inset.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">death_curves</span> <span class="op">+</span> <span class="fu">inset_element</span><span class="op">(</span><span class="va">death_log_curves</span>, </span>
<span>                             left <span class="op">=</span><span class="fl">0.02</span>, right <span class="op">=</span><span class="fl">0.4</span>, </span>
<span>                             bottom <span class="op">=</span> <span class="fl">0.45</span>, top <span class="op">=</span><span class="fl">0.98</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="visualization_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="visualization_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./transformation.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data transformation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./interactive.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Animated and Interactive Plots</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2022, Konstantinos I. Bougioukas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"selector":".lightbox","loop":true,"closeEffect":"zoom","openEffect":"zoom","descPosition":"bottom"});</script>


</body></html>